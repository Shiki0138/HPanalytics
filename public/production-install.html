<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨­ç½®ã‚¬ã‚¤ãƒ‰ - HPæ”¹å–„åˆ†æã‚·ã‚¹ãƒ†ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", "Inter", sans-serif;
        }
        
        body {
            background-color: #f8fafc;
        }
        
        .step-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border: 1px solid #f1f5f9;
            transition: all 0.2s ease;
        }
        
        .step-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            overflow-x: auto;
            position: relative;
            font-family: 'JetBrains Mono', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .copy-button {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #475569;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .copy-button:hover {
            background: #10b981;
        }
        
        .copy-button.copied {
            background: #10b981;
        }
        
        .step-number {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .check-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 8px;
            transition: background 0.2s;
        }
        
        .check-item:hover {
            background: #f1f5f9;
        }
        
        .feature-badge {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="bg-white border-b border-gray-200">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-red-600 rounded-xl flex items-center justify-center shadow-md">
                        <span class="text-white text-xl">ğŸ”§</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">è¨­ç½®ã‚¬ã‚¤ãƒ‰</h1>
                        <p class="text-sm text-gray-600">5åˆ†ã§å®Œäº†ã™ã‚‹ç°¡å˜ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</p>
                    </div>
                </div>
                <button onclick="window.location.href='/'" class="text-sm text-gray-600 hover:text-gray-900 font-medium">â† æˆ»ã‚‹</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Overview -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-8 mb-12 border border-blue-100">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">ğŸš€ HPæ”¹å–„åˆ†æã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚ãªãŸã®ã‚µã‚¤ãƒˆã«å°å…¥</h2>
            <p class="text-gray-700 mb-6">
                ã‚ãšã‹5åˆ†ã§è¨­ç½®å®Œäº†ã€‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å•é¡Œã‚’æ¤œå‡ºã—ã€å£²ä¸Šå‘ä¸Šã®ãŸã‚ã®å…·ä½“çš„ãªæ”¹å–„ç­–ã‚’æä¾›ã—ã¾ã™ã€‚
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white p-4 rounded-xl">
                    <div class="text-3xl mb-2">ğŸ›¡ï¸</div>
                    <h3 class="font-semibold text-gray-900 mb-1">ä¼æ¥­ç´šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</h3>
                    <p class="text-sm text-gray-600">GDPRæº–æ‹ ãƒ»å€‹äººæƒ…å ±ä¿è­·</p>
                </div>
                <div class="bg-white p-4 rounded-xl">
                    <div class="text-3xl mb-2">âš¡</div>
                    <h3 class="font-semibold text-gray-900 mb-1">è¶…é«˜é€Ÿå‹•ä½œ</h3>
                    <p class="text-sm text-gray-600">3.6KBãƒ»50msä»¥ä¸‹ã§åˆæœŸåŒ–</p>
                </div>
                <div class="bg-white p-4 rounded-xl">
                    <div class="text-3xl mb-2">ğŸ“Š</div>
                    <h3 class="font-semibold text-gray-900 mb-1">è‡ªå‹•åˆ†æ</h3>
                    <p class="text-sm text-gray-600">å•é¡Œã‚’è‡ªå‹•æ¤œå‡ºãƒ»æ”¹å–„ææ¡ˆ</p>
                </div>
            </div>
        </div>

        <!-- Installation Steps -->
        <div class="space-y-8">
            
            <!-- Step 1: Generate Site ID -->
            <div class="step-card p-8">
                <div class="flex items-start mb-6">
                    <div class="step-number mr-4">1</div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">ã‚µã‚¤ãƒˆIDã‚’ç”Ÿæˆ</h3>
                        <p class="text-gray-600">ã¾ãšã€ã‚ãªãŸã®ã‚µã‚¤ãƒˆå°‚ç”¨ã®IDã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-6 rounded-xl mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ã‚µã‚¤ãƒˆURL</label>
                    <div class="flex space-x-3">
                        <input type="url" 
                               id="siteUrl" 
                               placeholder="https://example.com" 
                               class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <button onclick="generateSiteId()" 
                                class="px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors">
                            ç”Ÿæˆ
                        </button>
                    </div>
                </div>
                
                <div id="siteIdResult" class="hidden bg-green-50 border border-green-200 rounded-xl p-4">
                    <p class="text-sm text-green-800 mb-2">âœ… ã‚µã‚¤ãƒˆIDãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ</p>
                    <div class="font-mono text-lg font-bold text-green-900" id="generatedSiteId">site_xxxxxxxx</div>
                </div>
            </div>

            <!-- Step 2: Install Tracking Code -->
            <div class="step-card p-8">
                <div class="flex items-start mb-6">
                    <div class="step-number mr-4">2</div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚³ãƒ¼ãƒ‰ã‚’è¨­ç½®</h3>
                        <p class="text-gray-600">ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚ãªãŸã®ã‚µã‚¤ãƒˆã® <code class="bg-gray-200 px-2 py-1 rounded text-sm">&lt;/body&gt;</code> ã‚¿ã‚°ã®ç›´å‰ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</p>
                    </div>
                </div>
                
                <div class="code-block">
                    <button class="copy-button" onclick="copyCode('trackingCode')">ã‚³ãƒ”ãƒ¼</button>
                    <pre id="trackingCode">&lt;!-- HPæ”¹å–„åˆ†æã‚·ã‚¹ãƒ†ãƒ  --&gt;
&lt;script&gt;
(function(){
    var script = document.createElement('script');
    script.src = 'https://hp-analytics-system.vercel.app/tracking-tag-production.js';
    script.async = true;
    script.onload = function() {
        window.HPAnalytics.config.siteId = '<span id="siteIdPlaceholder">YOUR_SITE_ID</span>';
        window.HPAnalytics.config.debug = false;
    };
    document.body.appendChild(script);
})();
&lt;/script&gt;</pre>
                </div>
                
                <div class="mt-4 flex space-x-4">
                    <span class="feature-badge">è‡ªå‹•ã‚¨ãƒ©ãƒ¼æ¤œå‡º</span>
                    <span class="feature-badge">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æ</span>
                    <span class="feature-badge">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·</span>
                </div>
            </div>

            <!-- Step 3: Verify Installation -->
            <div class="step-card p-8">
                <div class="flex items-start mb-6">
                    <div class="step-number mr-4">3</div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">å‹•ä½œç¢ºèª</h3>
                        <p class="text-gray-600">è¨­ç½®å¾Œã€ä»¥ä¸‹ã®é …ç›®ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
                    </div>
                </div>
                
                <div class="space-y-2 mb-6">
                    <div class="check-item">
                        <input type="checkbox" id="check1" class="w-4 h-4 text-blue-600 mr-3">
                        <label for="check1" class="text-gray-700">ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãªã„</label>
                    </div>
                    <div class="check-item">
                        <input type="checkbox" id="check2" class="w-4 h-4 text-blue-600 mr-3">
                        <label for="check2" class="text-gray-700">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§ tracking-tag-production.js ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹</label>
                    </div>
                    <div class="check-item">
                        <input type="checkbox" id="check3" class="w-4 h-4 text-blue-600 mr-3">
                        <label for="check3" class="text-gray-700">window.HPAnalytics ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã™ã‚‹</label>
                    </div>
                </div>
                
                <button onclick="verifyInstallation()" 
                        class="w-full bg-green-600 text-white py-3 rounded-xl font-semibold hover:bg-green-700 transition-colors">
                    å‹•ä½œç¢ºèªã‚’å®Ÿè¡Œ
                </button>
            </div>

            <!-- Step 4: Access Dashboard -->
            <div class="step-card p-8">
                <div class="flex items-start mb-6">
                    <div class="step-number mr-4">4</div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹</h3>
                        <p class="text-gray-600">è¨­ç½®ãŒå®Œäº†ã—ãŸã‚‰ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§åˆ†æçµæœã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-purple-50 to-indigo-50 p-6 rounded-xl mb-6">
                    <h4 class="font-semibold text-gray-900 mb-3">ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªæ©Ÿèƒ½:</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div class="flex items-center">
                            <span class="text-purple-600 mr-2">âœ“</span>
                            <span class="text-gray-700">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å•é¡Œæ¤œå‡º</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-purple-600 mr-2">âœ“</span>
                            <span class="text-gray-700">å£²ä¸Šæ”¹å–„ææ¡ˆ</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-purple-600 mr-2">âœ“</span>
                            <span class="text-gray-700">ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ãƒˆ</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-purple-600 mr-2">âœ“</span>
                            <span class="text-gray-700">è‡ªå‹•ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š</span>
                        </div>
                    </div>
                </div>
                
                <button onclick="window.location.href='/dashboard'" 
                        class="w-full bg-purple-600 text-white py-3 rounded-xl font-semibold hover:bg-purple-700 transition-colors">
                    ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’é–‹ã â†’
                </button>
            </div>

        </div>

        <!-- Support Section -->
        <div class="mt-12 bg-gray-50 rounded-2xl p-8">
            <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸ¤ ã‚µãƒãƒ¼ãƒˆ</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <h3 class="font-semibold text-gray-900 mb-2">ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</h3>
                    <p class="text-sm text-gray-600 mb-3">è©³ç´°ãªè¨­å®šæ–¹æ³•ã‚„APIä»•æ§˜</p>
                    <a href="#" class="text-blue-600 text-sm font-medium hover:underline">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã‚‹ â†’</a>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900 mb-2">ğŸ’¬ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£</h3>
                    <p class="text-sm text-gray-600 mb-3">ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨æƒ…å ±äº¤æ›</p>
                    <a href="#" class="text-blue-600 text-sm font-medium hover:underline">ãƒ•ã‚©ãƒ¼ãƒ©ãƒ ã«å‚åŠ  â†’</a>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900 mb-2">ğŸ“§ ãŠå•ã„åˆã‚ã›</h3>
                    <p class="text-sm text-gray-600 mb-3">24æ™‚é–“ä»¥å†…ã«è¿”ä¿¡ã—ã¾ã™</p>
                    <a href="#" class="text-blue-600 text-sm font-medium hover:underline">ã‚µãƒãƒ¼ãƒˆã«é€£çµ¡ â†’</a>
                </div>
            </div>
        </div>

    </main>

    <script>
        'use strict';
        
        // Input validation functions
        function isValidUrl(string) {
            try {
                const url = new URL(string);
                return url.protocol === 'http:' || url.protocol === 'https:';
            } catch (_) {
                return false;
            }
        }
        
        function sanitizeInput(input) {
            // Remove any script tags and dangerous characters
            return input.replace(/<script[^>]*>.*?<\/script>/gi, '')
                       .replace(/[<>'"&]/g, (char) => {
                           const entityMap = {
                               '<': '&lt;',
                               '>': '&gt;',
                               '"': '&quot;',
                               "'": '&#39;',
                               '&': '&amp;'
                           };
                           return entityMap[char];
                       })
                       .trim()
                       .substring(0, 2048); // Limit length
        }
        
        function validateSiteUrl(url) {
            if (!url || typeof url !== 'string') {
                return { valid: false, error: 'URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„' };
            }
            
            const sanitized = sanitizeInput(url);
            if (sanitized !== url) {
                return { valid: false, error: 'ç„¡åŠ¹ãªæ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ã¾ã™' };
            }
            
            if (!isValidUrl(url)) {
                return { valid: false, error: 'æœ‰åŠ¹ãªURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆhttp://ã¾ãŸã¯https://ã§é–‹å§‹ï¼‰' };
            }
            
            if (url.length > 2048) {
                return { valid: false, error: 'URLãŒé•·ã™ãã¾ã™' };
            }
            
            return { valid: true, url: sanitized };
        }
        
        // Generate Site ID with validation
        function generateSiteId() {
            const rawUrl = document.getElementById('siteUrl').value;
            const validation = validateSiteUrl(rawUrl);
            
            if (!validation.valid) {
                alert(validation.error);
                return;
            }
            
            // Generate unique ID with additional security
            const timestamp = Date.now();
            const random = Math.random().toString(36).substring(2, 8);
            const urlHash = btoa(validation.url).substring(0, 8).replace(/[^a-zA-Z0-9]/g, '');
            const siteId = `site_${timestamp}_${random}_${urlHash}`;
            
            // Validate generated siteId
            if (!/^[a-zA-Z0-9_]+$/.test(siteId)) {
                alert('ã‚µã‚¤ãƒˆIDç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                return;
            }
            
            // Show result (using textContent for security)
            document.getElementById('generatedSiteId').textContent = siteId;
            document.getElementById('siteIdResult').classList.remove('hidden');
            
            // Update tracking code (using textContent for security)
            document.getElementById('siteIdPlaceholder').textContent = siteId;
            
            // Smooth scroll to next step
            setTimeout(() => {
                const nextStep = document.querySelector('.step-card:nth-child(2)');
                if (nextStep) {
                    nextStep.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                }
            }, 500);
        }
        
        // Copy tracking code
        function copyCode(elementId) {
            const codeElement = document.getElementById(elementId);
            const textToCopy = codeElement.textContent;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                const button = event.target;
                button.textContent = 'ã‚³ãƒ”ãƒ¼å®Œäº†!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = 'ã‚³ãƒ”ãƒ¼';
                    button.classList.remove('copied');
                }, 2000);
            });
        }
        
        // Verify installation
        function verifyInstallation() {
            // Simulate verification
            const checks = ['check1', 'check2', 'check3'];
            let allChecked = true;
            
            checks.forEach(id => {
                if (!document.getElementById(id).checked) {
                    allChecked = false;
                }
            });
            
            if (allChecked) {
                alert('âœ… è¨­ç½®ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§åˆ†æçµæœã‚’ç¢ºèªã§ãã¾ã™ã€‚');
                
                // Auto-check all items
                checks.forEach(id => {
                    document.getElementById(id).checked = true;
                });
                
                // Scroll to dashboard section
                setTimeout(() => {
                    document.querySelector('.step-card:nth-child(4)').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                }, 500);
            } else {
                alert('âš ï¸ ã™ã¹ã¦ã®é …ç›®ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ã‚µãƒãƒ¼ãƒˆã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚');
            }
        }
    </script>
</body>
</html>