<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>設置ガイド - HP改善分析システム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", "Inter", sans-serif;
        }
        
        body {
            background-color: #f8fafc;
        }
        
        .step-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border: 1px solid #f1f5f9;
            transition: all 0.2s ease;
        }
        
        .step-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            overflow-x: auto;
            position: relative;
            font-family: 'JetBrains Mono', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .copy-button {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #475569;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .copy-button:hover {
            background: #10b981;
        }
        
        .copy-button.copied {
            background: #10b981;
        }
        
        .step-number {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .check-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 8px;
            transition: background 0.2s;
        }
        
        .check-item:hover {
            background: #f1f5f9;
        }
        
        .feature-badge {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="bg-white border-b border-gray-200">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-red-600 rounded-xl flex items-center justify-center shadow-md">
                        <span class="text-white text-xl">🔧</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">設置ガイド</h1>
                        <p class="text-sm text-gray-600">5分で完了する簡単セットアップ</p>
                    </div>
                </div>
                <button onclick="window.location.href='/'" class="text-sm text-gray-600 hover:text-gray-900 font-medium">← 戻る</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Overview -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-8 mb-12 border border-blue-100">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">🚀 HP改善分析システムをあなたのサイトに導入</h2>
            <p class="text-gray-700 mb-6">
                わずか5分で設置完了。リアルタイムで問題を検出し、売上向上のための具体的な改善策を提供します。
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white p-4 rounded-xl">
                    <div class="text-3xl mb-2">🛡️</div>
                    <h3 class="font-semibold text-gray-900 mb-1">企業級セキュリティ</h3>
                    <p class="text-sm text-gray-600">GDPR準拠・個人情報保護</p>
                </div>
                <div class="bg-white p-4 rounded-xl">
                    <div class="text-3xl mb-2">⚡</div>
                    <h3 class="font-semibold text-gray-900 mb-1">超高速動作</h3>
                    <p class="text-sm text-gray-600">3.6KB・50ms以下で初期化</p>
                </div>
                <div class="bg-white p-4 rounded-xl">
                    <div class="text-3xl mb-2">📊</div>
                    <h3 class="font-semibold text-gray-900 mb-1">自動分析</h3>
                    <p class="text-sm text-gray-600">問題を自動検出・改善提案</p>
                </div>
            </div>
        </div>

        <!-- Installation Steps -->
        <div class="space-y-8">
            
            <!-- Step 1: Generate Site ID -->
            <div class="step-card p-8">
                <div class="flex items-start mb-6">
                    <div class="step-number mr-4">1</div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">サイトIDを生成</h3>
                        <p class="text-gray-600">まず、あなたのサイト専用のIDを生成します。</p>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-6 rounded-xl mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">サイトURL</label>
                    <div class="flex space-x-3">
                        <input type="url" 
                               id="siteUrl" 
                               placeholder="https://example.com" 
                               class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <button onclick="generateSiteId()" 
                                class="px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors">
                            生成
                        </button>
                    </div>
                </div>
                
                <div id="siteIdResult" class="hidden bg-green-50 border border-green-200 rounded-xl p-4">
                    <p class="text-sm text-green-800 mb-2">✅ サイトIDが生成されました</p>
                    <div class="font-mono text-lg font-bold text-green-900" id="generatedSiteId">site_xxxxxxxx</div>
                </div>
            </div>

            <!-- Step 2: Install Tracking Code -->
            <div class="step-card p-8">
                <div class="flex items-start mb-6">
                    <div class="step-number mr-4">2</div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">トラッキングコードを設置</h3>
                        <p class="text-gray-600">以下のコードをあなたのサイトの <code class="bg-gray-200 px-2 py-1 rounded text-sm">&lt;/body&gt;</code> タグの直前に貼り付けてください。</p>
                    </div>
                </div>
                
                <div class="code-block">
                    <button class="copy-button" onclick="copyCode('trackingCode')">コピー</button>
                    <pre id="trackingCode">&lt;!-- HP改善分析システム --&gt;
&lt;script&gt;
(function(){
    var script = document.createElement('script');
    script.src = 'https://hp-analytics-system.vercel.app/tracking-tag-production.js';
    script.async = true;
    script.onload = function() {
        window.HPAnalytics.config.siteId = '<span id="siteIdPlaceholder">YOUR_SITE_ID</span>';
        window.HPAnalytics.config.debug = false;
    };
    document.body.appendChild(script);
})();
&lt;/script&gt;</pre>
                </div>
                
                <div class="mt-4 flex space-x-4">
                    <span class="feature-badge">自動エラー検出</span>
                    <span class="feature-badge">リアルタイム分析</span>
                    <span class="feature-badge">プライバシー保護</span>
                </div>
            </div>

            <!-- Step 3: Verify Installation -->
            <div class="step-card p-8">
                <div class="flex items-start mb-6">
                    <div class="step-number mr-4">3</div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">動作確認</h3>
                        <p class="text-gray-600">設置後、以下の項目を確認してください。</p>
                    </div>
                </div>
                
                <div class="space-y-2 mb-6">
                    <div class="check-item">
                        <input type="checkbox" id="check1" class="w-4 h-4 text-blue-600 mr-3">
                        <label for="check1" class="text-gray-700">ブラウザのコンソールにエラーが表示されていない</label>
                    </div>
                    <div class="check-item">
                        <input type="checkbox" id="check2" class="w-4 h-4 text-blue-600 mr-3">
                        <label for="check2" class="text-gray-700">ネットワークタブで tracking-tag-production.js が読み込まれている</label>
                    </div>
                    <div class="check-item">
                        <input type="checkbox" id="check3" class="w-4 h-4 text-blue-600 mr-3">
                        <label for="check3" class="text-gray-700">window.HPAnalytics オブジェクトが存在する</label>
                    </div>
                </div>
                
                <button onclick="verifyInstallation()" 
                        class="w-full bg-green-600 text-white py-3 rounded-xl font-semibold hover:bg-green-700 transition-colors">
                    動作確認を実行
                </button>
            </div>

            <!-- Step 4: Access Dashboard -->
            <div class="step-card p-8">
                <div class="flex items-start mb-6">
                    <div class="step-number mr-4">4</div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">ダッシュボードにアクセス</h3>
                        <p class="text-gray-600">設置が完了したら、ダッシュボードで分析結果を確認できます。</p>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-purple-50 to-indigo-50 p-6 rounded-xl mb-6">
                    <h4 class="font-semibold text-gray-900 mb-3">アクセス可能な機能:</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div class="flex items-center">
                            <span class="text-purple-600 mr-2">✓</span>
                            <span class="text-gray-700">リアルタイム問題検出</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-purple-600 mr-2">✓</span>
                            <span class="text-gray-700">売上改善提案</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-purple-600 mr-2">✓</span>
                            <span class="text-gray-700">カスタムレポート</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-purple-600 mr-2">✓</span>
                            <span class="text-gray-700">自動アラート設定</span>
                        </div>
                    </div>
                </div>
                
                <button onclick="window.location.href='/dashboard'" 
                        class="w-full bg-purple-600 text-white py-3 rounded-xl font-semibold hover:bg-purple-700 transition-colors">
                    ダッシュボードを開く →
                </button>
            </div>

        </div>

        <!-- Support Section -->
        <div class="mt-12 bg-gray-50 rounded-2xl p-8">
            <h2 class="text-xl font-bold text-gray-900 mb-6">🤝 サポート</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <h3 class="font-semibold text-gray-900 mb-2">📚 ドキュメント</h3>
                    <p class="text-sm text-gray-600 mb-3">詳細な設定方法やAPI仕様</p>
                    <a href="#" class="text-blue-600 text-sm font-medium hover:underline">ドキュメントを見る →</a>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900 mb-2">💬 コミュニティ</h3>
                    <p class="text-sm text-gray-600 mb-3">他のユーザーと情報交換</p>
                    <a href="#" class="text-blue-600 text-sm font-medium hover:underline">フォーラムに参加 →</a>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900 mb-2">📧 お問い合わせ</h3>
                    <p class="text-sm text-gray-600 mb-3">24時間以内に返信します</p>
                    <a href="#" class="text-blue-600 text-sm font-medium hover:underline">サポートに連絡 →</a>
                </div>
            </div>
        </div>

    </main>

    <script>
        'use strict';
        
        // Input validation functions
        function isValidUrl(string) {
            try {
                const url = new URL(string);
                return url.protocol === 'http:' || url.protocol === 'https:';
            } catch (_) {
                return false;
            }
        }
        
        function sanitizeInput(input) {
            // Remove any script tags and dangerous characters
            return input.replace(/<script[^>]*>.*?<\/script>/gi, '')
                       .replace(/[<>'"&]/g, (char) => {
                           const entityMap = {
                               '<': '&lt;',
                               '>': '&gt;',
                               '"': '&quot;',
                               "'": '&#39;',
                               '&': '&amp;'
                           };
                           return entityMap[char];
                       })
                       .trim()
                       .substring(0, 2048); // Limit length
        }
        
        function validateSiteUrl(url) {
            if (!url || typeof url !== 'string') {
                return { valid: false, error: 'URLを入力してください' };
            }
            
            const sanitized = sanitizeInput(url);
            if (sanitized !== url) {
                return { valid: false, error: '無効な文字が含まれています' };
            }
            
            if (!isValidUrl(url)) {
                return { valid: false, error: '有効なURLを入力してください（http://またはhttps://で開始）' };
            }
            
            if (url.length > 2048) {
                return { valid: false, error: 'URLが長すぎます' };
            }
            
            return { valid: true, url: sanitized };
        }
        
        // Generate Site ID with validation
        function generateSiteId() {
            const rawUrl = document.getElementById('siteUrl').value;
            const validation = validateSiteUrl(rawUrl);
            
            if (!validation.valid) {
                alert(validation.error);
                return;
            }
            
            // Generate unique ID with additional security
            const timestamp = Date.now();
            const random = Math.random().toString(36).substring(2, 8);
            const urlHash = btoa(validation.url).substring(0, 8).replace(/[^a-zA-Z0-9]/g, '');
            const siteId = `site_${timestamp}_${random}_${urlHash}`;
            
            // Validate generated siteId
            if (!/^[a-zA-Z0-9_]+$/.test(siteId)) {
                alert('サイトID生成に失敗しました。もう一度お試しください。');
                return;
            }
            
            // Show result (using textContent for security)
            document.getElementById('generatedSiteId').textContent = siteId;
            document.getElementById('siteIdResult').classList.remove('hidden');
            
            // Update tracking code (using textContent for security)
            document.getElementById('siteIdPlaceholder').textContent = siteId;
            
            // Smooth scroll to next step
            setTimeout(() => {
                const nextStep = document.querySelector('.step-card:nth-child(2)');
                if (nextStep) {
                    nextStep.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                }
            }, 500);
        }
        
        // Copy tracking code
        function copyCode(elementId) {
            const codeElement = document.getElementById(elementId);
            const textToCopy = codeElement.textContent;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                const button = event.target;
                button.textContent = 'コピー完了!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = 'コピー';
                    button.classList.remove('copied');
                }, 2000);
            });
        }
        
        // Verify installation
        function verifyInstallation() {
            // Simulate verification
            const checks = ['check1', 'check2', 'check3'];
            let allChecked = true;
            
            checks.forEach(id => {
                if (!document.getElementById(id).checked) {
                    allChecked = false;
                }
            });
            
            if (allChecked) {
                alert('✅ 設置が正常に完了しました！ダッシュボードで分析結果を確認できます。');
                
                // Auto-check all items
                checks.forEach(id => {
                    document.getElementById(id).checked = true;
                });
                
                // Scroll to dashboard section
                setTimeout(() => {
                    document.querySelector('.step-card:nth-child(4)').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                }, 500);
            } else {
                alert('⚠️ すべての項目を確認してください。問題がある場合はサポートにお問い合わせください。');
            }
        }
    </script>
</body>
</html>