!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).AIAnalytics={})}(this,function(t){"use strict";function e(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}function i(){return(null===performance||void 0===performance?void 0:performance.now)?performance.now()+performance.timeOrigin:Date.now()}function s(t){if(t.id)return`#${t.id}`;if(t.className){const e=t.className.toString().split(/\s+/).filter(Boolean);if(e.length>0)return`.${e[0]}`}return t.tagName.toLowerCase()}function n(t=window.location.href){const e=new URL(t),i={};return["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(t=>{const s=e.searchParams.get(t);s&&(i[t.replace("utm_","")]=s)}),Object.keys(i).length>0?i:{}}function r(){var t,e,i,s,n;const{navigator:r,screen:o,window:h}=globalThis;return{userAgent:(null==r?void 0:r.userAgent)||"",screenResolution:o?`${o.width}x${o.height}`:"",viewportSize:h?`${h.innerWidth}x${h.innerHeight}`:"",devicePixelRatio:(null==h?void 0:h.devicePixelRatio)||1,language:(null==r?void 0:r.language)||(null==r?void 0:r.userLanguage)||"",timezone:(null===(s=null===(i=null===(e=null===(t=null===Intl||void 0===Intl?void 0:Intl.DateTimeFormat)||void 0===t?void 0:t.call(Intl))||void 0===e?void 0:e.resolvedOptions)||void 0===i?void 0:i.call(e))||void 0===s?void 0:s.timeZone)||"",connectionType:null===(n=null==r?void 0:r.connection)||void 0===n?void 0:n.effectiveType,isMobile:/Mobi|Android/i.test((null==r?void 0:r.userAgent)||""),isTouch:"ontouchstart"in h||(null==r?void 0:r.maxTouchPoints)>0}}function o(){return"undefined"!=typeof window&&"undefined"!=typeof document}function h(t,e=3){if(e<=0)return"[Object]";if(null==t)return t;if("function"==typeof t)return"[Function]";if("symbol"==typeof t)return"[Symbol]";if(t instanceof Error)return{name:t.name,message:t.message,stack:t.stack};if(t instanceof Date)return t.toISOString();if("object"!=typeof t)return t;if(Array.isArray(t))return t.slice(0,100).map(t=>h(t,e-1));const i={};let s=0;for(const[n,r]of Object.entries(t)){if(s>=50)break;i[n]=h(r,e-1),s++}return i}class c{constructor(){this.t=new Map}getItem(t){return this.t.get(t)||null}setItem(t,e){this.t.set(t,e)}removeItem(t){this.t.delete(t)}clear(){this.t.clear()}}class a{constructor(){this.i="ai_analytics_",!function(){if(!o())return!1;try{const t="__storage_test__";return window.localStorage.setItem(t,t),window.localStorage.removeItem(t),!0}catch(t){return!1}}()?!function(){if(!o())return!1;try{const t="__storage_test__";return window.sessionStorage.setItem(t,t),window.sessionStorage.removeItem(t),!0}catch(t){return!1}}()?this.o=new c:this.o=window.sessionStorage:this.o=window.localStorage}h(t){return`${this.i}${t}`}getItem(t,e){try{const i=this.o.getItem(this.h(t));return null===i?e||null:function(t,e){try{return JSON.parse(t)}catch(t){return e}}(i,e)}catch(t){return e||null}}setItem(t,e){try{this.o.setItem(this.h(t),function(t){try{return JSON.stringify(t)}catch(t){return"{}"}}(e))}catch(t){}}removeItem(t){try{this.o.removeItem(this.h(t))}catch(t){}}clear(){try{if(this.o instanceof c)return void this.o.clear();const t=[],e=this.o;for(let i=0;i<e.length;i++){const s=e.key(i);s&&s.startsWith(this.i)&&t.push(s)}t.forEach(t=>e.removeItem(t))}catch(t){}}getEventQueue(){return this.getItem("event_queue",[])}setEventQueue(t){const e=t.slice(-1e3);this.setItem("event_queue",e)}addToQueue(t){const e=this.getEventQueue();e.push(t),this.setEventQueue(e)}removeFromQueue(t){const e=this.getEventQueue(),i=new Set(t.map(t=>t.timestamp)),s=e.filter(t=>!i.has(t.timestamp));this.setEventQueue(s)}getSessionData(){return{sessionId:this.getItem("session_id"),userId:this.getItem("user_id"),lastActivity:this.getItem("last_activity"),userProperties:this.getItem("user_properties",{})}}setSessionId(t){this.setItem("session_id",t)}setUserId(t){this.setItem("user_id",t)}setLastActivity(t){this.setItem("last_activity",t)}setUserProperties(t){const e={...this.getItem("user_properties",{}),...t};this.setItem("user_properties",e)}clearSession(){this.removeItem("session_id"),this.removeItem("user_id"),this.removeItem("last_activity"),this.removeItem("user_properties")}getStorageSize(){try{let t=0;if(this.o instanceof c)for(const[e,i]of this.o.t)t+=e.length+i.length;else{const e=this.o;for(let i=0;i<e.length;i++){const s=e.key(i);if(s&&s.startsWith(this.i)){const i=e.getItem(s);t+=s.length+((null==i?void 0:i.length)||0)}}}return 2*t}catch(t){return 0}}isAvailable(){try{const t=this.h("__test__");this.o.setItem(t,"test");const e=this.o.getItem(t);return this.o.removeItem(t),"test"===e}catch(t){return!1}}getStorageType(){return this.o===window.localStorage?"localStorage":this.o===window.sessionStorage?"sessionStorage":"memory"}}class u{constructor(){this.u=new Set,this.l=new Set,this.p()}onMetric(t){return this.u.add(t),()=>this.u.delete(t)}p(){"undefined"!=typeof window&&"undefined"!=typeof document&&(this.v(),this.m(),this._(),this.I(),this.T())}S(t){this.l.has(t.name)||(this.l.add(t.name),this.u.forEach(e=>{try{e(t)}catch(t){}}))}P(t,e){const i={CLS:[.1,.25],FCP:[1800,3e3],FID:[100,300],LCP:[2500,4e3],TTFB:[800,1800]}[t];return i?e<=i[0]?"good":e<=i[1]?"needs-improvement":"poor":"good"}C(){if("undefined"!=typeof navigator&&"connection"in navigator){const t=performance.getEntriesByType("navigation")[0];return(null==t?void 0:t.type)||"navigate"}return"navigate"}v(){if(!("LayoutShift"in window))return;let t=0,e=[],i=0,s=[],n=this.F();const r=new PerformanceObserver(r=>{for(const o of r.getEntries()){const r=o;if(!r.hadRecentInput){this.k(r,n)?(i>t&&(t=i,e=s),n=this.F(),i=r.value,s=[o]):(i+=r.value,s.push(o))}}i>t&&(t=i,e=s)});try{r.observe({type:"layout-shift",buffered:!0});const i=()=>{this.S({name:"CLS",value:t,rating:this.P("CLS",t),entries:e,navigationType:this.C()})};document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&i()}),window.addEventListener("beforeunload",i)}catch(t){}}k(t,e){const i=!this.L,s=t.startTime-(this.L||0)>1e3,n=t.startTime-(this.O||t.startTime)>5e3;return i&&(this.O=t.startTime),this.L=t.startTime,i||s||n}F(){return Math.random().toString(36).substring(2)}m(){const t=new PerformanceObserver(e=>{for(const i of e.getEntries())if("first-contentful-paint"===i.name){this.S({name:"FCP",value:i.startTime,rating:this.P("FCP",i.startTime),entries:[i],navigationType:this.C()}),t.disconnect();break}});try{t.observe({type:"paint",buffered:!0})}catch(t){}}_(){const t=new PerformanceObserver(e=>{for(const i of e.getEntries()){const e=i,s=e.processingStart-e.startTime;this.S({name:"FID",value:s,rating:this.P("FID",s),entries:[i],navigationType:this.C()}),t.disconnect();break}});try{t.observe({type:"first-input",buffered:!0})}catch(t){}}I(){let t=0,e=null;const i=new PerformanceObserver(i=>{const s=i.getEntries(),n=s[s.length-1];n&&n.startTime>t&&(t=n.startTime,e=n)});try{i.observe({type:"largest-contentful-paint",buffered:!0});const s=()=>{e&&this.S({name:"LCP",value:t,rating:this.P("LCP",t),entries:[e],navigationType:this.C()})};document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&s()}),window.addEventListener("beforeunload",s)}catch(t){}}T(){const t=new PerformanceObserver(e=>{for(const i of e.getEntries()){const e=i,s=e.responseStart-e.requestStart;this.S({name:"TTFB",value:s,rating:this.P("TTFB",s),entries:[i],navigationType:this.C()}),t.disconnect();break}});try{t.observe({type:"navigation",buffered:!0})}catch(t){if("undefined"!=typeof performance&&performance.timing){const t=performance.timing.responseStart-performance.timing.requestStart;t>0&&this.S({name:"TTFB",value:t,rating:this.P("TTFB",t),entries:[],navigationType:"navigate"})}}}collectAll(){try{const t=performance.getEntriesByType("paint").find(t=>"first-contentful-paint"===t.name);t&&!this.l.has("FCP")&&this.S({name:"FCP",value:t.startTime,rating:this.P("FCP",t.startTime),entries:[t],navigationType:this.C()})}catch(t){}}destroy(){this.u.clear(),this.l.clear()}}class d{constructor(){this.j=[],this.o=new a,this.A=this.D(),this.M()}init(t){var e,i;if(!o())return;this.A.config={endpoint:"/api/collect",sampleRate:1,debug:!1,userProperties:{},offlineStorage:!0,batchSize:10,flushInterval:5e3,webVitals:!0,errorTracking:!0,cookieConsent:()=>!0,...t},(null===(i=(e=this.A.config).cookieConsent)||void 0===i?void 0:i.call(e))&&(Math.random()>this.A.config.sampleRate||(this.$(),this.U(),this.A.config.webVitals&&this.B(),this.A.config.errorTracking&&this.N(),this.R(),this.J(),this.A.isInitialized=!0,this.A.config.debug,this.page()))}track(t,e={}){if(!this.q())return;const s={type:t,timestamp:i(),sessionId:this.A.sessionId,userId:this.A.userId,properties:h(e)};this.H(s),this.V(),this.A.config.debug}page(t,e,s={}){if(!this.q())return;const r=t||(o()?window.location.href:""),c=e||(o()?document.title:""),a=o()?document.referrer:"",u={type:"pageview",timestamp:i(),sessionId:this.A.sessionId,userId:this.A.userId,url:r,title:c,referrer:a||void 0,utm:n(r),properties:h(s)};this.H(u),this.V(),this.A.config.debug}identify(t,e={}){this.q()&&(this.A.userId=t,this.o.setUserId(t),this.setUserProperties(e),this.A.config.debug)}setUserProperties(t){if(!this.q())return;const e=h(t);this.A.userProperties={...this.A.userProperties,...e},this.o.setUserProperties(this.A.userProperties),this.A.config.debug}async flush(){this.q()&&(await this.K(),this.A.config.debug)}reset(){var t;this.W&&clearInterval(this.W),this.X&&clearTimeout(this.X),this.o.clearSession(),this.A=this.D(),null===(t=this.A.config)||void 0===t||t.debug}getSessionId(){return this.A.sessionId}getUserId(){return this.A.userId||null}D(){return{config:{},sessionId:e(),deviceInfo:r(),userProperties:{},eventQueue:[],isInitialized:!1,lastActivity:i(),pageLoadTime:i()}}q(){return!!o()&&!!this.A.isInitialized}$(){const t=this.o.getSessionData(),s=i();t.sessionId&&t.lastActivity&&s-t.lastActivity<18e5?(this.A.sessionId=t.sessionId,this.A.userId=t.userId,this.A.userProperties=t.userProperties):(this.A.sessionId=e(),this.o.setSessionId(this.A.sessionId)),this.V()}U(){if(!this.A.config.offlineStorage)return;const t=this.o.getEventQueue();this.j=t,this.A.config.debug&&t.length}B(){this.G=new u,this.G.onMetric(t=>{const e={type:"web-vital",timestamp:i(),sessionId:this.A.sessionId,userId:this.A.userId,name:t.name,value:t.value,rating:t.rating,navigationType:t.navigationType,properties:{entries:t.entries.length}};this.H(e)})}N(){this.Y=t=>{var e;const s={type:"error",timestamp:i(),sessionId:this.A.sessionId,userId:this.A.userId,message:t.message||"Unknown error",stack:null===(e=t.error)||void 0===e?void 0:e.stack,filename:t.filename,lineno:t.lineno,colno:t.colno};this.H(s)},window.addEventListener("error",this.Y),window.addEventListener("unhandledrejection",t=>{var e,s;const n={type:"error",timestamp:i(),sessionId:this.A.sessionId,userId:this.A.userId,message:(null===(e=t.reason)||void 0===e?void 0:e.message)||"Unhandled promise rejection",stack:null===(s=t.reason)||void 0===s?void 0:s.stack,properties:{type:"unhandledrejection"}};this.H(n)})}M(){o()&&(this.Z=function(t,e){let i;return(...s)=>{i||(t(...s),i=!0,setTimeout(()=>{i=!1},e))}}(t=>{var e;if(!this.q())return;const n=t.target;if(!n)return;const r={type:"click",timestamp:i(),sessionId:this.A.sessionId,userId:this.A.userId,selector:s(n),coordinates:{x:t.clientX,y:t.clientY},text:(null===(e=n.textContent)||void 0===e?void 0:e.slice(0,100))||void 0};this.H(r),this.V()},100),document.addEventListener("click",this.Z),this.tt=()=>{this.et()},window.addEventListener("beforeunload",this.tt),this.it=()=>{"hidden"===document.visibilityState&&this.et()},document.addEventListener("visibilitychange",this.it))}R(){this.W&&clearInterval(this.W),this.W=window.setInterval(()=>{this.K().catch(()=>{})},this.A.config.flushInterval)}J(){this.X&&clearTimeout(this.X),this.X=window.setTimeout(()=>{this.A.sessionId=e(),this.o.setSessionId(this.A.sessionId),this.A.config.debug},18e5)}H(t){const e={event:t,retries:0,timestamp:i()};this.j.push(e),this.A.config.offlineStorage&&this.o.addToQueue(e),this.j.length>=this.A.config.batchSize&&this.K().catch(()=>{})}V(){this.A.lastActivity=i(),this.o.setLastActivity(this.A.lastActivity),this.J()}async K(){if(0===this.j.length)return;const t=[...this.j],e={projectId:this.A.config.projectId,sessionId:this.A.sessionId,userId:this.A.userId,userProperties:this.A.userProperties,deviceInfo:this.A.deviceInfo,events:t.map(t=>t.event),timestamp:i()};try{const i=await fetch(this.A.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok)throw new Error(`HTTP ${i.status}`);this.j=this.j.filter(e=>!t.some(t=>t.timestamp===e.timestamp)),this.A.config.offlineStorage&&this.o.removeFromQueue(t),this.A.config.debug}catch(e){t.forEach(t=>{if(t.retries++,t.retries>=3){const e=this.j.findIndex(e=>e.timestamp===t.timestamp);e>=0&&this.j.splice(e,1)}}),this.A.config.debug}}et(){if(0===this.j.length)return;const t={projectId:this.A.config.projectId,sessionId:this.A.sessionId,userId:this.A.userId,userProperties:this.A.userProperties,deviceInfo:this.A.deviceInfo,events:this.j.map(t=>t.event),timestamp:i()};try{if(navigator.sendBeacon)navigator.sendBeacon(this.A.config.endpoint,JSON.stringify(t));else{const e=new XMLHttpRequest;e.open("POST",this.A.config.endpoint,!1),e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify(t))}this.j=[],this.A.config.offlineStorage&&this.o.setEventQueue([])}catch(t){this.A.config.debug}}destroy(){var t;this.W&&clearInterval(this.W),this.X&&clearTimeout(this.X),this.Z&&document.removeEventListener("click",this.Z),this.Y&&window.removeEventListener("error",this.Y),this.tt&&window.removeEventListener("beforeunload",this.tt),this.it&&document.removeEventListener("visibilitychange",this.it),null===(t=this.G)||void 0===t||t.destroy(),this.et()}}function l(){return new d}function f(){if("undefined"!=typeof window&&window.aiAnalytics&&!Array.isArray(window.aiAnalytics))return;const t=l();((null===window||void 0===window?void 0:window.aiAnalytics)||[]).forEach(({method:e,args:i})=>{if("function"==typeof t[e])try{t[e](...i)}catch(t){}}),"undefined"!=typeof window&&(window.aiAnalytics=t)}"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",f):setTimeout(f,0)),"undefined"!=typeof module&&module.exports&&(module.exports={createTracker:l,Tracker:d}),function(t){if(t.aiAnalytics&&!Array.isArray(t.aiAnalytics))return;t.aiAnalytics=t.aiAnalytics||[],t.aiAnalyticsQ=t.aiAnalyticsQ||[];["init","track","page","identify","setUserProperties","flush","reset"].forEach(e=>{t.aiAnalytics[e]=(...i)=>function(e,...i){Array.isArray(t.aiAnalytics)?t.aiAnalytics.push({method:e,args:i}):"function"==typeof t.aiAnalytics[e]&&t.aiAnalytics[e](...i)}(e,...i)})}("undefined"!=typeof window?window:{}),t.Tracker=d,t.createTracker=l});
