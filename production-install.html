<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HP改善分析システム - 本番環境設置ガイド</title>
    
    <!-- セキュリティヘッダー -->
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            position: relative;
        }
        .copy-button {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #4b5563;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .copy-button:hover {
            background: #22c55e;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-5xl mx-auto p-6">
        
        <!-- ヘッダー -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-4">
                🚀 HP改善分析システム - 本番環境設置ガイド
            </h1>
            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                <p class="text-green-800">
                    <strong>✅ セキュリティ強化版</strong> - 本番環境での安全な運用に最適化されています
                </p>
            </div>
        </div>

        <!-- 事前準備 -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-900 mb-4">📋 事前準備チェックリスト</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="space-y-2">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="w-4 h-4 text-blue-600">
                        <span class="text-sm">HTTPS対応済み</span>
                    </label>
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="w-4 h-4 text-blue-600">
                        <span class="text-sm">Content Security Policy設定</span>
                    </label>
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="w-4 h-4 text-blue-600">
                        <span class="text-sm">プライバシーポリシー策定</span>
                    </label>
                </div>
                <div class="space-y-2">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="w-4 h-4 text-blue-600">
                        <span class="text-sm">GDPR対応確認</span>
                    </label>
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="w-4 h-4 text-blue-600">
                        <span class="text-sm">ユーザー同意取得仕組み</span>
                    </label>
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="w-4 h-4 text-blue-600">
                        <span class="text-sm">バックアップ体制構築</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- ステップ1: サイトIDの生成 -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold mr-4">1</div>
                <h2 class="text-xl font-bold text-gray-900">サイトIDの生成と設定</h2>
            </div>
            
            <p class="text-gray-600 mb-4">
                まず、あなたのサイト専用のIDを生成してください。このIDは分析データの識別に使用されます。
            </p>

            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                <p class="text-yellow-800 text-sm">
                    <strong>重要:</strong> このIDは秘密情報として扱い、第三者に共有しないでください。
                </p>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">サイト名</label>
                    <input type="text" id="siteName" class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="例: 株式会社サンプル コーポレートサイト">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">サイトURL</label>
                    <input type="url" id="siteUrl" class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="https://example.com">
                </div>
                <button id="generateSiteIdBtn" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                    サイトIDを生成
                </button>
                <div id="generatedSiteId" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-2">生成されたサイトID</label>
                    <div class="bg-gray-100 border rounded-lg p-3">
                        <code id="siteIdValue" class="text-sm font-mono"></code>
                        <button data-copy-target="siteIdValue" class="copy-btn ml-2 bg-gray-500 text-white text-xs px-2 py-1 rounded">
                            コピー
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ステップ2: トラッキングタグの設置 -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-green-500 text-white rounded-full flex items-center justify-center font-bold mr-4">2</div>
                <h2 class="text-xl font-bold text-gray-900">本番用トラッキングタグの設置</h2>
            </div>
            
            <p class="text-gray-600 mb-4">
                以下のコードをあなたのサイトの全ページの <code class="bg-gray-100 px-2 py-1 rounded">&lt;/body&gt;</code> タグの直前に貼り付けてください。
            </p>

            <div id="trackingCodeSection">
                <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                    <p class="text-red-800 text-sm">
                        ⚠️ まずステップ1でサイトIDを生成してください
                    </p>
                </div>
            </div>
        </div>

        <!-- ステップ3: 動作確認 -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-purple-500 text-white rounded-full flex items-center justify-center font-bold mr-4">3</div>
                <h2 class="text-xl font-bold text-gray-900">動作確認とテスト</h2>
            </div>
            
            <div class="space-y-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">基本動作確認</h3>
                    <ol class="list-decimal list-inside space-y-2 text-gray-600">
                        <li>ブラウザの開発者ツール（F12）を開く</li>
                        <li>コンソールタブで「HP Analytics: Initialized」メッセージを確認</li>
                        <li>Networkタブでトラッキングデータの送信を確認</li>
                        <li>エラーが表示されていないことを確認</li>
                    </ol>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">機能別テスト</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-2">フォーム追跡テスト</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>✓ フォームにフォーカス</li>
                                <li>✓ フォーム送信</li>
                                <li>✓ フォーム離脱</li>
                            </ul>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-2">クリック追跡テスト</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>✓ ボタンクリック</li>
                                <li>✓ リンククリック</li>
                                <li>✓ CTAクリック</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ステップ4: ダッシュボードアクセス -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-indigo-500 text-white rounded-full flex items-center justify-center font-bold mr-4">4</div>
                <h2 class="text-xl font-bold text-gray-900">分析ダッシュボードへのアクセス</h2>
            </div>
            
            <p class="text-gray-600 mb-4">
                トラッキング開始後、以下のURLで分析結果を確認できます。
            </p>

            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="font-medium text-blue-900">分析ダッシュボード</p>
                        <p class="text-blue-700 text-sm">
                            <span id="dashboardUrl">https://your-domain.com/production-dashboard.html</span>
                        </p>
                    </div>
                    <button data-copy-target="dashboardUrl" class="copy-btn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors">
                        URLコピー
                    </button>
                </div>
            </div>
        </div>

        <!-- セキュリティとプライバシー -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4">🔒 セキュリティとプライバシー保護</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-semibold text-gray-800 mb-3">実装済みセキュリティ機能</h3>
                    <ul class="text-sm text-gray-600 space-y-2">
                        <li class="flex items-start">
                            <span class="text-green-500 mr-2">✓</span>
                            HTTPS通信の強制
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-2">✓</span>
                            データの完全サニタイゼーション
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-2">✓</span>
                            XSS攻撃の防止
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-2">✓</span>
                            レート制限による不正アクセス防止
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-2">✓</span>
                            Content Security Policy対応
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-semibold text-gray-800 mb-3">プライバシー保護</h3>
                    <ul class="text-sm text-gray-600 space-y-2">
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">✓</span>
                            個人情報は収集しません
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">✓</span>
                            IPアドレスの記録なし
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">✓</span>
                            GDPR完全準拠
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">✓</span>
                            データ保持期間の制限
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">✓</span>
                            オプトアウト機能
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- サポートとメンテナンス -->
        <div class="bg-gray-100 rounded-lg p-6">
            <h2 class="text-lg font-bold text-gray-900 mb-4">🛠️ メンテナンスとサポート</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center">
                    <div class="text-2xl mb-2">📊</div>
                    <h3 class="font-medium text-gray-800 mb-2">定期レポート</h3>
                    <p class="text-sm text-gray-600">月次で詳細な分析レポートを自動生成</p>
                </div>
                <div class="text-center">
                    <div class="text-2xl mb-2">🔄</div>
                    <h3 class="font-medium text-gray-800 mb-2">自動アップデート</h3>
                    <p class="text-sm text-gray-600">セキュリティパッチとバグ修正を自動適用</p>
                </div>
                <div class="text-center">
                    <div class="text-2xl mb-2">💬</div>
                    <h3 class="font-medium text-gray-800 mb-2">24時間サポート</h3>
                    <p class="text-sm text-gray-600">技術的な問題や疑問にいつでも対応</p>
                </div>
            </div>
        </div>

    </div>

    <script>
        // DOM読み込み完了後の初期化
        document.addEventListener('DOMContentLoaded', function() {
            // イベントリスナー設定
            const generateBtn = document.getElementById('generateSiteIdBtn');
            if (generateBtn) {
                generateBtn.addEventListener('click', generateSiteId);
            }
            
            // コピーボタンの一括イベント設定
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('copy-btn')) {
                    const targetId = e.target.getAttribute('data-copy-target');
                    if (targetId) {
                        copyToClipboard(targetId);
                    }
                }
            });
        });
        
        // サイトID生成（グローバルスコープで定義し、windowオブジェクトにも明示的に付与）
        function generateSiteId() {
            const siteName = document.getElementById('siteName').value;
            const siteUrl = document.getElementById('siteUrl').value;
            
            if (!siteName || !siteUrl) {
                alert('サイト名とURLを入力してください');
                return;
            }
            
            // セキュアなサイトID生成
            const timestamp = Date.now();
            const random = Math.random().toString(36).substr(2, 8);
            const hash = btoa(siteName + siteUrl + timestamp).substr(0, 12);
            const siteId = `hp_${hash}_${random}`;
            
            document.getElementById('siteIdValue').textContent = siteId;
            document.getElementById('generatedSiteId').classList.remove('hidden');
            
            // トラッキングコード生成
            generateTrackingCode(siteId);
        }
        
        // windowオブジェクトに関数を明示的にアタッチ
        window.generateSiteId = generateSiteId;
        
        // トラッキングコード生成
        function generateTrackingCode(siteId) {
            const trackingCode = `&lt;!-- HP改善分析システム - 本番環境用 --&gt;
&lt;script&gt;
(function(){
    var script = document.createElement('script');
    script.src = 'https://your-domain.com/tracking-tag-production.js';
    script.async = true;
    script.onload = function() {
        // サイトID設定
        window.HPAnalytics.config.siteId = '${siteId}';
        
        // 本番環境用設定
        window.HPAnalytics.config.debug = false;
        window.HPAnalytics.config.apiEndpoint = 'https://api.hp-analytics.example.com/track';
        
        console.log('✅ HP改善分析システム（本番版）が正常に読み込まれました');
    };
    script.onerror = function() {
        console.error('❌ HP改善分析システムの読み込みに失敗しました');
    };
    document.body.appendChild(script);
})();
&lt;/script&gt;
&lt;!-- /HP改善分析システム --&gt;`;
            
            const codeSection = document.getElementById('trackingCodeSection');
            codeSection.innerHTML = `
                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                    <p class="text-green-800 text-sm">
                        ✅ サイトID「${siteId}」用のトラッキングコードが生成されました
                    </p>
                </div>
                <div class="code-block">
                    <pre><code id="trackingCode">${trackingCode}</code></pre>
                    <button data-copy-target="trackingCode" class="copy-btn copy-button">コピー</button>
                </div>
                <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <p class="text-yellow-800 text-sm">
                        <strong>注意:</strong> 上記のコードで「your-domain.com」を実際のドメインに変更してください。
                    </p>
                </div>
            `;
        }
        
        // クリップボードコピー
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            let text = element.textContent;
            
            // HTMLエンティティをデコード
            if (elementId === 'trackingCode') {
                text = text.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&');
            }
            
            navigator.clipboard.writeText(text).then(function() {
                // 成功フィードバック
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'コピーしました！';
                button.style.background = '#22c55e';
                
                setTimeout(function() {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            }).catch(function() {
                // フォールバック
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('コードがクリップボードにコピーされました');
            });
        }
        
        // windowオブジェクトにも明示的にアタッチ
        window.copyToClipboard = copyToClipboard;
        window.generateTrackingCode = generateTrackingCode;
    </script>
</body>
</html>