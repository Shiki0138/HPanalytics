# AIウェブ分析システム要件定義書

## 文書情報
- **文書名**: AIウェブ分析システム要件定義書
- **バージョン**: 1.0
- **作成日**: 2025年1月20日
- **作成者**: システム開発チーム
- **承認者**: プロジェクトオーナー

---

## 1. プロジェクト基本情報

### 1.1 プロジェクト概要
- **プロジェクト名**: AIウェブ分析システム（仮称：AI Analytics Tag）
- **開発期間**: 2025年2月1日 - 2025年7月31日（6ヶ月）
- **予算**: 400-500万円
- **開発体制**: 
  - プロジェクトオーナー: 1名
  - フルスタックエンジニア: 1名（フリーランス）
  - デザイナー: 必要に応じてスポット契約

### 1.2 背景と目的

#### 背景
- 中小企業の93%がWebサイトの効果を実感できていない
- Google Analyticsは高機能だが中小企業には複雑すぎる
- 月額1-5万円の価格帯で使いやすい分析ツールが不足
- AI技術の進歩により、自動分析・インサイト生成が可能に

#### 目的
1. 中小企業でも簡単に使えるWeb分析ツールの提供
2. AIによる自動分析で、専門知識なしでも改善点を把握
3. 月額1万円程度の低価格で高品質な分析サービスを実現
4. 6ヶ月以内にMVPをリリースし、市場検証を実施

### 1.3 ステークホルダー
| 役割 | 責任範囲 | 関与度 |
|------|----------|--------|
| プロジェクトオーナー | 全体統括・意思決定 | 高 |
| 開発エンジニア | 設計・実装・テスト | 高 |
| 初期顧客（10社） | 要件フィードバック・テスト | 中 |
| デザイナー | UI/UXデザイン | 低 |

---

## 2. システム全体像

### 2.1 システム概要
本システムは、Webサイトに1行のJavaScriptタグを埋め込むだけで、アクセス解析とAI分析を行うSaaSサービスです。

### 2.2 システム構成図
```
[ユーザーWebサイト]
    ↓ JavaScriptタグ
[データ収集API]
    ↓
[データ処理サーバー] ← [AI分析エンジン]
    ↓
[データベース]
    ↓
[Web管理画面] → [顧客]
```

### 2.3 主要機能一覧
1. **データ収集機能**: JavaScriptタグによる自動収集
2. **リアルタイム分析**: 基本指標の即時表示
3. **AI分析**: トレンド分析・異常検知・インサイト生成
4. **レポート機能**: 週次・月次レポート自動生成
5. **アラート機能**: 異常値検知時の通知

---

## 3. 機能要件

### 3.1 データ収集機能

#### 3.1.1 JavaScriptタグ
**要件ID**: FR-001  
**優先度**: 必須  
**詳細**:
- 1行のコードでWebサイトに埋め込み可能
- 非同期読み込みでサイト表示速度に影響しない
- gzip圧縮で10KB以下のファイルサイズ

**実装例**:
```javascript
<script async src="https://cdn.ai-analytics.jp/tag.js?id=CUSTOMER_ID"></script>
```

#### 3.1.2 収集データ項目
**要件ID**: FR-002  
**優先度**: 必須  
**収集項目**:
| データ種別 | 項目 | 形式 | 例 |
|-----------|------|------|-----|
| ページ情報 | URL | 文字列 | https://example.com/products |
| | タイトル | 文字列 | 商品一覧 - Example Shop |
| | 閲覧開始時刻 | タイムスタンプ | 2025-01-20 10:23:45 |
| | 滞在時間 | 秒 | 127 |
| ユーザー情報 | ユーザーID | UUID | 550e8400-e29b-41d4-a716-446655440000 |
| | セッションID | UUID | 6ba7b810-9dad-11d1-80b4-00c04fd430c8 |
| | 新規/リピーター | フラグ | new/returning |
| デバイス情報 | デバイス種別 | 文字列 | mobile/tablet/desktop |
| | OS | 文字列 | iOS 17.0 |
| | ブラウザ | 文字列 | Chrome 120.0 |
| | 画面解像度 | 文字列 | 1920x1080 |
| 流入情報 | リファラー | URL | https://google.com |
| | UTMパラメータ | JSON | {"source": "google", "medium": "cpc"} |

#### 3.1.3 データ送信仕様
**要件ID**: FR-003  
**優先度**: 必須  
**詳細**:
- HTTPS通信必須
- 5秒ごとにバッチ送信
- 失敗時は最大3回リトライ
- ローカルストレージに一時保存（オフライン対応）

### 3.2 管理画面機能

#### 3.2.1 ダッシュボード
**要件ID**: FR-004  
**優先度**: 必須  
**表示項目**:
1. **リアルタイム訪問者数**: 現在サイトを閲覧中の人数
2. **本日のサマリー**: PV、UU、セッション数、直帰率、平均滞在時間
3. **グラフ表示**: 時間別・日別・週別・月別の推移
4. **流入元分析**: 検索、SNS、直接流入、参照サイトの割合
5. **人気ページランキング**: TOP 10ページ

**画面仕様**:
- レスポンシブデザイン（PC/タブレット/スマホ対応）
- グラフはChart.jsで実装
- データ更新間隔: 5分
- CSV/PDFエクスポート機能

#### 3.2.2 AI分析レポート
**要件ID**: FR-005  
**優先度**: 必須  
**分析項目**:
1. **週次トレンド分析**
   - 先週比での増減率
   - 異常値の検知
   - 要因分析（曜日、時間帯、流入元）

2. **改善提案**
   - 離脱率の高いページの特定
   - 改善優先度の提示
   - 具体的な改善アクション案

3. **競合比較**（Phase 2で実装）
   - 業界平均との比較
   - 強み・弱みの分析

**出力例**:
```
【今週の分析結果】
✅ アクセス数が先週比15%増加しました
⚠️ 商品詳細ページの離脱率が80%と高い状態です
💡 改善提案：商品画像を増やすことで滞在時間が平均30%向上する可能性があります
```

#### 3.2.3 ユーザー管理
**要件ID**: FR-006  
**優先度**: 必須  
**機能**:
1. **アカウント管理**
   - メールアドレスでの登録
   - パスワードリセット機能
   - 2段階認証（オプション）

2. **サイト管理**
   - 最大3サイトまで登録可能（MVP版）
   - サイトごとのトラッキングID発行
   - ドメイン検証機能

3. **権限管理**
   - オーナー: 全機能利用可能
   - 閲覧者: レポート閲覧のみ

### 3.3 通知・アラート機能

#### 3.3.1 異常値検知アラート
**要件ID**: FR-007  
**優先度**: 高  
**アラート条件**:
- アクセス数が前日比50%以上増減
- エラーページ（404/500）へのアクセス急増
- 特定ページの離脱率が90%超過

**通知方法**:
- メール通知（必須）
- 管理画面内通知（必須）
- Slack連携（Phase 2）

---

## 4. 非機能要件

### 4.1 性能要件

#### 4.1.1 レスポンスタイム
**要件ID**: NFR-001  
**詳細**:
| 機能 | 目標値 | 最大許容値 |
|------|--------|------------|
| タグ読み込み | 50ms | 100ms |
| データ送信 | 100ms | 200ms |
| ダッシュボード表示 | 1秒 | 3秒 |
| レポート生成 | 3秒 | 10秒 |

#### 4.1.2 スループット
**要件ID**: NFR-002  
**詳細**:
- 同時接続数: 1,000サイト
- データ処理能力: 10,000イベント/秒
- 月間データ量: 100GB

### 4.2 可用性要件

**要件ID**: NFR-003  
**SLA目標**: 99.5%（月間ダウンタイム: 約3.6時間）  
**詳細**:
- 計画メンテナンス: 月1回、深夜2-4時
- バックアップ: 日次自動バックアップ
- 災害復旧: 24時間以内

### 4.3 セキュリティ要件

#### 4.3.1 データ保護
**要件ID**: NFR-004  
**詳細**:
1. **通信の暗号化**
   - 全通信をHTTPS（TLS 1.3）で暗号化
   - 証明書はLet's Encryptを使用

2. **データの暗号化**
   - パスワード: bcryptでハッシュ化
   - 個人情報: AES-256で暗号化

3. **アクセス制御**
   - IPアドレス制限機能
   - ログイン試行回数制限（5回失敗で30分ロック）

#### 4.3.2 個人情報保護
**要件ID**: NFR-005  
**準拠法令**: 個人情報保護法、GDPR  
**対応**:
- IPアドレスの匿名化
- Cookieの利用について明示
- オプトアウト機能の実装
- データ保持期間: 14ヶ月（自動削除）

### 4.4 ユーザビリティ要件

**要件ID**: NFR-006  
**詳細**:
1. **学習容易性**: 説明書なしで基本機能を使える
2. **操作性**: 3クリック以内で主要機能にアクセス
3. **エラー処理**: 分かりやすいエラーメッセージ
4. **多言語対応**: 日本語のみ（MVP版）

---

## 5. システムアーキテクチャ

### 5.1 技術スタック

#### フロントエンド
```
- Framework: React.js 18.2.0
- UI Library: Material-UI 5.14.0
- Chart: Chart.js 4.4.0
- State Management: Redux Toolkit 1.9.0
- Build Tool: Vite 4.4.0
```

#### バックエンド
```
- Runtime: Node.js 20.10.0
- Framework: Express.js 4.18.0
- ORM: Prisma 5.7.0
- Queue: Bull 4.11.0
- Cache: Redis 7.2.0
```

#### インフラストラクチャ
```
- Cloud: AWS
- Web Server: Nginx
- Application: PM2
- Container: Docker
- CI/CD: GitHub Actions
```

#### データベース
```
- Main DB: PostgreSQL 15.5
- Cache: Redis 7.2.0
- Analytics: TimescaleDB
```

### 5.2 システム構成図

```
┌─────────────────┐     ┌──────────────────┐
│  CloudFront CDN │────▶│ S3 (Static Files)│
└─────────────────┘     └──────────────────┘
         │
         ▼
┌─────────────────┐     ┌──────────────────┐
│   ALB          │────▶│ EC2 (Node.js)    │
└─────────────────┘     └──────────────────┘
                               │
                    ┌──────────┴──────────┐
                    ▼                     ▼
           ┌──────────────┐      ┌──────────────┐
           │ RDS (PostgreSQL)│    │ ElastiCache  │
           └──────────────┘      └──────────────┘
```

### 5.3 データフロー

1. **データ収集フロー**
```
ユーザーサイト → JavaScriptタグ実行 → データ収集API 
→ Kinesis Data Streams → Lambda → RDS/S3
```

2. **分析処理フロー**
```
RDS → 定期バッチ（Lambda） → AI分析処理 → 結果をRDSに保存
→ キャッシュ更新（Redis） → API経由で画面表示
```

---

## 6. データベース設計

### 6.1 ER図
```
[users]
  - id (UUID) PK
  - email (VARCHAR)
  - password_hash (VARCHAR)
  - created_at (TIMESTAMP)
  - updated_at (TIMESTAMP)

[sites]
  - id (UUID) PK
  - user_id (UUID) FK
  - name (VARCHAR)
  - domain (VARCHAR)
  - tracking_id (VARCHAR) UNIQUE
  - created_at (TIMESTAMP)

[page_views]
  - id (BIGSERIAL) PK
  - site_id (UUID) FK
  - session_id (UUID)
  - user_id (UUID)
  - page_url (TEXT)
  - page_title (VARCHAR)
  - referrer (TEXT)
  - timestamp (TIMESTAMP)
  - duration (INTEGER)

[sessions]
  - id (UUID) PK
  - site_id (UUID) FK
  - user_agent (TEXT)
  - ip_address_hash (VARCHAR)
  - device_type (VARCHAR)
  - browser (VARCHAR)
  - os (VARCHAR)
  - started_at (TIMESTAMP)
  - ended_at (TIMESTAMP)
```

### 6.2 インデックス設計
```sql
-- 高速検索用インデックス
CREATE INDEX idx_page_views_site_timestamp ON page_views(site_id, timestamp);
CREATE INDEX idx_page_views_session ON page_views(session_id);
CREATE INDEX idx_sessions_site_started ON sessions(site_id, started_at);

-- パーティショニング（月別）
CREATE TABLE page_views_2025_01 PARTITION OF page_views
FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');
```

---

## 7. API仕様

### 7.1 認証API

#### POST /api/auth/login
**説明**: ユーザーログイン  
**リクエスト**:
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```
**レスポンス**:
```json
{
  "token": "eyJhbGciOiJIUzI1NiIs...",
  "user": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com"
  }
}
```

### 7.2 データ収集API

#### POST /api/collect
**説明**: トラッキングデータの送信  
**ヘッダー**: `X-Tracking-ID: CUSTOMER_TRACKING_ID`  
**リクエスト**:
```json
{
  "events": [
    {
      "type": "pageview",
      "url": "https://example.com/products",
      "title": "商品一覧",
      "timestamp": "2025-01-20T10:23:45Z",
      "session_id": "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
    }
  ]
}
```

### 7.3 分析データAPI

#### GET /api/sites/{site_id}/analytics
**説明**: 分析データの取得  
**パラメータ**:
- `start_date`: 開始日（YYYY-MM-DD）
- `end_date`: 終了日（YYYY-MM-DD）
- `metrics`: 取得する指標（カンマ区切り）

**レスポンス**:
```json
{
  "summary": {
    "pageviews": 15234,
    "users": 3421,
    "sessions": 4532,
    "bounce_rate": 0.45,
    "avg_duration": 127
  },
  "timeseries": [
    {
      "date": "2025-01-20",
      "pageviews": 523,
      "users": 187
    }
  ]
}
```

---

## 8. 画面設計

### 8.1 画面一覧
| 画面ID | 画面名 | 説明 | 優先度 |
|--------|--------|------|--------|
| SC-001 | ログイン画面 | メールアドレスとパスワードでログイン | 必須 |
| SC-002 | ダッシュボード | メイン分析画面 | 必須 |
| SC-003 | AI分析レポート | AI による分析結果表示 | 必須 |
| SC-004 | サイト設定 | トラッキングコード表示・設定 | 必須 |
| SC-005 | アカウント設定 | ユーザー情報・パスワード変更 | 必須 |

### 8.2 画面遷移図
```
[ログイン画面] → [ダッシュボード] → [AI分析レポート]
                        ↓                    ↓
                  [サイト設定]    [アカウント設定]
```

### 8.3 ダッシュボード画面設計

#### レイアウト
```
┌─────────────────────────────────────────────┐
│ ヘッダー（ロゴ・サイト選択・ユーザーメニュー）    │
├─────────────────────────────────────────────┤
│ 期間選択（今日/昨日/7日間/30日間/カスタム）      │
├──────────────┬──────────────────────────────┤
│              │  リアルタイム訪問者数          │
│  サイドメニュー │  ┌────┐ ┌────┐ ┌────┐     │
│              │  │ PV │ │ UU │ │セッション│  │
│ ・ダッシュボード │  └────┘ └────┘ └────┘     │
│ ・AI分析      │  ┌─────────────────────┐    │
│ ・設定        │  │  時系列グラフ         │    │
│              │  └─────────────────────┘    │
│              │  ┌─────────────────────┐    │
│              │  │  流入元円グラフ       │    │
│              │  └─────────────────────┘    │
└──────────────┴──────────────────────────────┘
```

#### UI要素仕様
1. **数値カード**
   - 大きな数字で現在値表示
   - 前期間比を%で表示（緑: 増加、赤: 減少）
   - ホバーで詳細情報表示

2. **グラフ**
   - Chart.jsで実装
   - ツールチップで詳細値表示
   - ズーム・パン機能

3. **期間選択**
   - プリセット期間をボタンで選択
   - カスタム期間はDatePickerで選択

---

## 9. テスト計画

### 9.1 テスト種別と範囲

| テスト種別 | 対象 | 実施時期 | 合格基準 |
|-----------|------|----------|----------|
| 単体テスト | 全API・関数 | 開発中 | カバレッジ80%以上 |
| 結合テスト | API連携 | 機能完成後 | 全シナリオ成功 |
| 性能テスト | 負荷テスト | β版前 | 要件値達成 |
| セキュリティテスト | 脆弱性診断 | リリース前 | 重大な脆弱性なし |
| ユーザビリティテスト | 画面操作 | β版 | タスク完了率90% |

### 9.2 テストシナリオ例

#### データ収集テスト
1. JavaScriptタグを設置
2. 複数ページを閲覧
3. 管理画面でデータ確認
4. 期待値: 全アクセスが記録される

#### 性能テスト
1. JMeterで1,000同時接続
2. 10,000イベント/秒を送信
3. レスポンスタイム測定
4. 期待値: 200ms以内

### 9.3 テスト環境
- **開発環境**: ローカルDocker環境
- **ステージング環境**: AWS（本番相当）
- **テストデータ**: 本番想定の10%規模

---

## 10. デプロイ・運用

### 10.1 デプロイフロー

1. **開発環境**
```bash
# ローカル開発
npm run dev
# Dockerコンテナ起動
docker-compose up
```

2. **ステージング環境**
```bash
# GitHub Actions自動デプロイ
git push origin develop
# → 自動テスト実行 → ステージングデプロイ
```

3. **本番環境**
```bash
# タグ付けでリリース
git tag v1.0.0
git push origin v1.0.0
# → 承認 → 本番デプロイ
```

### 10.2 監視項目

| 監視項目 | ツール | アラート閾値 |
|---------|--------|-------------|
| サーバー死活 | AWS CloudWatch | 3分無応答 |
| CPU使用率 | CloudWatch | 80%超過 |
| メモリ使用率 | CloudWatch | 90%超過 |
| エラー率 | Sentry | 1%超過 |
| レスポンスタイム | New Relic | 3秒超過 |

### 10.3 バックアップ・リカバリ

1. **バックアップ**
   - RDS: 自動バックアップ（日次）
   - S3: バージョニング有効
   - 設定ファイル: Git管理

2. **リカバリ手順**
   - RTO（目標復旧時間）: 4時間
   - RPO（目標復旧時点）: 1日前
   - 手順書: 運用マニュアル参照

---

## 11. 開発スケジュール

### 11.1 マイルストーン

| フェーズ | 期間 | 成果物 |
|---------|------|--------|
| Phase 1: 設計・環境構築 | 2週間 | 詳細設計書、開発環境 |
| Phase 2: 基本機能開発 | 6週間 | データ収集、基本画面 |
| Phase 3: AI機能開発 | 4週間 | AI分析、レポート機能 |
| Phase 4: 結合・テスト | 4週間 | テスト完了、バグ修正 |
| Phase 5: β版リリース | 2週間 | 初期顧客への提供 |
| Phase 6: 改善・本番化 | 4週間 | フィードバック反映、正式版 |

### 11.2 詳細スケジュール（WBS）

#### Phase 1: 設計・環境構築（2週間）
- [ ] 詳細設計書作成（3日）
- [ ] 開発環境構築（2日）
- [ ] AWSアカウント設定（1日）
- [ ] CI/CD環境構築（2日）
- [ ] データベース設計（2日）

#### Phase 2: 基本機能開発（6週間）
- [ ] JavaScriptタグ開発（1週間）
- [ ] データ収集API開発（1週間）
- [ ] ユーザー認証機能（1週間）
- [ ] ダッシュボード画面（2週間）
- [ ] 基本的な分析機能（1週間）

#### Phase 3: AI機能開発（4週間）
- [ ] AI分析エンジン実装（2週間）
- [ ] インサイト生成機能（1週間）
- [ ] レポート生成機能（1週間）

#### Phase 4: 結合・テスト（4週間）
- [ ] 結合テスト（1週間）
- [ ] 性能テスト（1週間）
- [ ] セキュリティテスト（1週間）
- [ ] バグ修正（1週間）

#### Phase 5: β版リリース（2週間）
- [ ] 本番環境構築（3日）
- [ ] 初期顧客への導入（1週間）
- [ ] フィードバック収集（4日）

#### Phase 6: 改善・本番化（4週間）
- [ ] フィードバック対応（2週間）
- [ ] ドキュメント整備（1週間）
- [ ] 正式版リリース（1週間）

### 11.3 リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| 開発遅延 | 高 | 中 | 週次進捗確認、スコープ調整 |
| 技術的課題 | 中 | 低 | 事前検証、代替案準備 |
| 要件変更 | 中 | 中 | 変更管理プロセス確立 |
| 人材不足 | 高 | 低 | バックアップ要員確保 |

---

## 12. 成功基準

### 12.1 MVP成功基準
1. **機能要件**: 必須機能の100%実装
2. **性能要件**: 定義した性能値の達成
3. **品質**: 重大バグゼロ
4. **納期**: 6ヶ月以内にリリース
5. **顧客満足**: β版顧客の70%が継続利用

### 12.2 ビジネス成功基準
1. **顧客獲得**: 6ヶ月で20社獲得
2. **収益**: 月間売上100万円達成
3. **継続率**: 月次チャーン率10%以下
4. **NPS**: 30以上

---

## 13. 制約事項・前提条件

### 13.1 制約事項
1. **予算**: 500万円以内
2. **期間**: 6ヶ月以内
3. **人員**: フルタイム1名＋パートタイム
4. **技術**: オープンソース中心

### 13.2 前提条件
1. プロジェクトオーナーが要件決定権を持つ
2. 初期顧客10社の協力が得られる
3. AWSクレジットが利用可能
4. 開発者のスキルセットが要件に適合

---

## 14. 用語集

| 用語 | 説明 |
|------|------|
| PV (Page View) | ページが表示された回数 |
| UU (Unique User) | サイトを訪問したユーザー数 |
| セッション | 一連のページ閲覧行動 |
| 直帰率 | 1ページだけ見て離脱した割合 |
| コンバージョン | 目標とする行動の達成 |
| トラッキングID | サイトを識別する一意のID |
| インサイト | データから得られる洞察 |

---

## 15. 承認

本要件定義書は、以下の関係者により確認・承認されました。

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| プロジェクトオーナー | _____ | 2025/1/__ | _____ |
| 開発責任者 | _____ | 2025/1/__ | _____ |
| 初期顧客代表 | _____ | 2025/1/__ | _____ |

---

## 変更履歴

| 版数 | 変更日 | 変更内容 | 変更者 |
|------|--------|----------|--------|
| 1.0 | 2025/1/20 | 初版作成 | システム開発チーム |

---

以上